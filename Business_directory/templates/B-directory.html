<!DOCTYPE html>
<html>
<head>
    <title>MSME Chatbot</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #chat-container { height: 400px; border: 1px solid #ddd; overflow-y: auto; padding: 10px; margin-bottom: 10px; }
        #user-input { width: 70%; padding: 5px; }
        button { padding: 5px 10px; }
    </style>
</head>
<body>
    <h1>MSME Chatbot</h1>
    <div id="chat-container"></div>
    <input type="text" id="user-input" placeholder="Type your message here...">
    <button onclick="sendMessage()">Send</button>
    <button id="resetButton" onclick="resetConversation()">Reset Conversation</button>
    <script>
    let conversationCount = 0;

    function resetConversation() {
        $.ajax({
            url: 'http://localhost:5000/reset_conversation',
            type: 'POST',
            contentType: 'application/json',
            success: function(response) {
                $('#chat-container').empty(); // Clear previous chat messages
                $('#chat-container').append('<p><strong>System:</strong> Conversation has been reset.</p>');
                $('#chat-container').append('<p><strong>Bot:</strong> ' + response.message + '</p>');
                $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);
                conversationCount = response.conversation_count;
            },
            error: function(xhr, status, error) {
                console.log("HTML error");
                $('#chat-container').append('<p><strong>Error:</strong> ' + error + '</p>');
                $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);
            }
        });
    }

    function sendMessage() {
        var userInput = $('#user-input').val();
        $('#chat-container').append('<p><strong>You:</strong> ' + userInput + '</p>');
        
        $.ajax({
            url: 'http://localhost:5000/chat',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                message: userInput,
                conversation_count: conversationCount
            }),
            success: function(response) {
                $('#chat-container').append('<p><strong>Bot:</strong> ' + response.response + '</p>');
                $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);
                conversationCount = response.conversation_count;
            },
            error: function(xhr, status, error) {
                $('#chat-container').append('<p><strong>Error:</strong> ' + error + '</p>');
                $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);
            }
        });
        
        $('#user-input').val('');
    }

    $('#user-input').keypress(function(e) {
        if(e.which == 13) {
            sendMessage();
        }
    });

    // Add event listener for the reset button
    document.getElementById('resetButton').addEventListener('click', resetConversation);

    function getInitialMessage() {
        $.ajax({
            url: 'http://localhost:5000/chat',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                message: "Initial message",
                conversation_count: 0
            }),
            success: function(response) {
                $('#chat-container').append('<p><strong>Bot:</strong> ' + response.response + '</p>');
                $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);
                conversationCount = response.conversation_count;
            },
            error: function(xhr, status, error) {
                $('#chat-container').append('<p><strong>Error:</strong> ' + error + '</p>');
                $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);
            }
        });
    }

    // Initial message when page loads
    $(document).ready(function() {
        getInitialMessage();
    });
    </script>
</body>
</html>
